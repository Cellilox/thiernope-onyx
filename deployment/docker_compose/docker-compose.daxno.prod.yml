version: '3'

services:
  daxno-backend:
    image: ${DOCKERHUB_USERNAME}/daxno-backend:latest
    container_name: daxno-backend
    restart: unless-stopped
    env_file:
      - path: ../../../daxno-backend/.env.prod
        required: true
    environment:
      - POSTGRES_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@relational_db:5432/${POSTGRES_DB}
      - ONYX_INTERNAL_URL=http://api_server:8080
      - ONYX_API_URL=http://api_server:8080
      - ONYX_PUBLIC_URL=https://${ONYX_DOMAIN:-agents.cellilox.com}/api
      - ONYX_DB_URL=postgresql+asyncpg://${POSTGRES_USER}:${POSTGRES_PASSWORD}@relational_db:5432/onyx
      - REDIS_URL=redis://cache:6379/0
      - BACKEND_ROOT_URL=https://${API_DOMAIN:-api.cellilox.com}
      - FRONTEND_ROOT_URL=https://${FRONTEND_DOMAIN:-cellilox.com}
    depends_on:
      - relational_db
      - cache
    networks:
      - default

  daxno-frontend:
    image: ${DOCKERHUB_USERNAME}/daxno-frontend:prod
    container_name: daxno-frontend
    restart: unless-stopped
    env_file:
      - path: ../../../daxno-frontend/.env.prod
        required: true
    environment:
      - NEXT_PUBLIC_API_URL=https://${API_DOMAIN:-api.cellilox.com}
      - NEXT_PUBLIC_ONYX_URL=https://${ONYX_DOMAIN:-agents.cellilox.com}
      - INTERNAL_API_URL=http://daxno-backend:8000
    depends_on:
      - daxno-backend
    networks:
      - default

networks:
  default:
    name: onyx_default
